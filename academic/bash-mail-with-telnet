#!/bin/bash

# Author: Andrew Howard

#TO="inbox@fqdn"
TO="inbox@fqdn"
FROM="inbox@fqdn"
HOSTNAME=`hostname`
SUBJECT="R1Soft ($HOSTNAME): Yesterday's errors, today!"

{
sleep 1
echo "EHLO $HOSTNAME"
sleep 1
echo "MAIL FROM: $FROM"
sleep 1
echo "RCPT TO: $TO"
sleep 1
echo "DATA"
sleep 1
echo "To: $TO"
echo "Reply-to: $FROM"
echo "From: $FROM"
echo "Subject: $SUBJECT"
echo ""
echo "Each host runs multiple backup tasks per day.  This message lists each host that had at least one task fail, followed by a list of all that host's tasks that did fail.  Hosts with no failures are not listed, and tasks that succeeded are not listed."
echo ""
echo "For additional info, login to $HOSTNAME and search for the specific TaskID in /usr/r1soft/buserver/log/server-log.txt.1"
echo "The easy way to do this is like so:"
echo "# debug.sh tid:657291"
echo "That will drop you into a 'less' session with only the relevant log entries"
echo ""
echo "Format of this email is as follows:"
echo "(Hostname):  (tid:TaskID) (tid:TaskID) ..."
echo ""
/root/r1soft-error-report.sh
echo ""
echo "This message generated by /root/report-wrapper.sh on $HOSTNAME."
echo "Contact Andrew Howard with questions."
echo ""
echo "."
echo ""
} | telnet SERVER 25

